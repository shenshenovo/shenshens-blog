---
import type { GetStaticPaths } from 'astro'
import type { CollectionEntry } from 'astro:content'
import { getCollection } from 'astro:content'
import MarkdownLayout from '@/layouts/MarkdownLayout.astro'
import Highlight from '@/components/Highlight.astro'
import SectionBlock from '@/components/SectionBlock.astro'
import MarkdownWrapper from '@/components/MarkdownWrapper.astro'
import { ReadingProgress } from '@/components/post/ReadingProgress'
import { PostToc } from '@/components/post/PostToc'

// 1. 获取 'life' 集合
export const getStaticPaths = (async () => {
  const lifeList = await getCollection('life')

  return lifeList.map((md) => ({
    params: { slug: md.slug }, // 2. params 的 key 必须是 'slug'
    props: {
      md,
    },
  }))
}) satisfies GetStaticPaths

// 3. Props 类型改成 'life'
interface Props {
  md: CollectionEntry<'life'>
}

const { md } = Astro.props

const { headings, Content } = await md.render()

const isMdContentEmpty = md.body.trim().length === 0
---

{/* 4. 我们只保留 MarkdownLayout 这一半，删掉了 PageLayout 那一半 */}
<MarkdownLayout
  title={md.data.title}
  description={md.data.description}
  mdTitle={md.data.title}
  mdDescription={md.data.description}
  mdSlug={`/life/${md.slug}`}
>
  <div
    class="max-w-[1100px] mx-auto px-4 md:px-8 py-16 grid lg:grid-cols-[auto_260px] gap-8"
    data-pagefind-body
  >
    <div>
      <header class="space-y-4">
        <h1 class="text-4xl font-bold">
          <Highlight>{md.data.title}</Highlight>
        </h1>
        {/* 5. 我们用 description 替换了博客的 meta 信息 */}
        <p>{md.data.description}</p>
      </header>
    </div>
    <div class="col-start-1 min-w-0">
      {!isMdContentEmpty && (
        <MarkdownWrapper>
          <Content />
        </MarkdownWrapper>
      )}
    </div>
    <div class="hidden lg:block" data-pagefind-ignore>
      <aside class="sticky top-20">
        <SectionBlock title="目录">
          <PostToc headings={headings} client:idle />
          <hr class="my-2 border-primary max-w-[100px]" />
          <ReadingProgress client:idle />
        </SectionBlock>
      </aside>
    </div>
    
    {/* 6. 我们删掉了 "Comments" 和 "PostNav" 等博客专用组件 */}

  </div>
</MarkdownLayout>